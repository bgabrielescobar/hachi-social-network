
window.onload = () => {
    const signupFormSection = document.querySelector('.section-signup-form');
    const signinFormSection = document.querySelector('.section-signin-form');
    const signupLink = document.querySelector('.signup-image').querySelector('a');
    const signinLink = document.querySelector('.signin-image').querySelector('a');

    signupLink.addEventListener('click', function() {
        signinFormSection.classList.remove('display-off');
        signinFormSection.classList.add('display-on');
        signupFormSection.classList.add('display-off');
        signupFormSection.classList.remove('display-on');
    });

    signinLink.addEventListener('click', function() {
        signinFormSection.classList.remove('display-on');
        signinFormSection.classList.add('display-off');
        signupFormSection.classList.add('display-on');
        signupFormSection.classList.remove('display-off');
    });

    /**
     * add to master js
     */
    const alertDialogCloseBtn = document.querySelector('.closebtn');
    alertDialogCloseBtn.addEventListener('click', function () {
        const alertDiv = document.querySelector('.alert');
        alertDiv.classList.remove("display-alert");
    })

};

function insertUser() {
    let registerForm = document.querySelector('#register-form');
    registerForm.addEventListener('submit', (event) => {event.preventDefault()});
    const URL_SIGN_UP = '/register.php';
    const FORM_DATA = new FormData(registerForm)
    var postData = {};
    for (var pair of FORM_DATA.entries()) {
        postData[pair[0]] = pair[1];
    }

    const response = fetch(URL_SIGN_UP, {
    method: 'POST',
    cache: 'no-cache',
    body: JSON.stringify(postData)
    })
    .then(response => response.json())
    .then(data => {
        alertDialog(data["bgcolor"], data['title'], data['message']);
    });
}

function loginUser() {
    let loginForm = document.querySelector("#login-form");
    console.log('testing login')
    loginForm.addEventListener('submit', (event) => {event.preventDefault()});
    const URL_LOG_IN = '/login.php';
    const FORM_DATA = new FormData(loginForm);
    var jsonPost = {};
    for (var pair of FORM_DATA.entries()) {
        jsonPost[pair[0]] = pair[1];
    }
    const response = fetch(URL_LOG_IN, {
        method: 'POST',
        cache: 'no-cache',
        body: JSON.stringify(jsonPost)
    })
        .then(response => response.json())
        .then(data => {
            if (data['code'] == 0) {
                window.location.href = "/home.php";
            } else {
                alertDialog(data["bgcolor"], data['title'], data['message']);
            }
        });
}

function alertDialog(backgroundColor, title, message) {
    const alertDiv = document.querySelector('.alert');
    if (alertDiv.classList.contains("display-alert")) {
        alertDiv.classList.remove("display-alert");
    }
    alertDiv.classList.add("display-alert");
    alertDiv.style.backgroundColor = backgroundColor;
    alertDiv.querySelector('strong').textContent = title;
    alertDiv.querySelector('p').textContent = message;

    setTimeout(() => {
        alertDiv.classList.remove("display-alert");
    }, 3000)
}